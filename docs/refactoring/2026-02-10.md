# Refactoring Log — 2026-02-10

## What happened today

### Studied the dispatch table pattern

Analyzed `refactoring/sample_dispatch.c` — a simplified version of how git's
`git.c` dispatches builtin commands. The key takeaway is the two-step split:

1. **Lookup** (`get_builtin`) — finds the command in the table, returns the
   whole struct (not just the function pointer).
2. **Execution** (`run_builtin`) — reads option flags, performs conditional
   setup, then calls the function.

This separation exists because different commands need different setup before
running, and centralizing that logic in the runner avoids duplicating it inside
every command function.

### Studied bitwise flags for per-command configuration

Each command in the dispatch table carries an `option` field (unsigned int) where
each bit represents a config aspect: `RUN_SETUP`, `NEED_WORK_TREE`, etc. Flags
are combined with OR and tested with AND. This is the standard C pattern for
packing multiple booleans into one integer cheaply.

### Reorganized project documentation

Created `docs/` directory structure to track project knowledge in git:

- `docs/learning/` — learned patterns and concepts
- `docs/refactoring/` — daily refactoring logs (this file)
- `docs/decisions/` — implementation trade-off notes (to be filled)

Previously, refactoring notes lived in `refactoring/` which is gitignored. The
new `docs/` structure is tracked so that project evolution is visible.
